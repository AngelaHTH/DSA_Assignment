// static/js/dashboard.js
async function fetchDashboardData() {
    try {
        const response = await fetch('/api/dashboard');
        if (!response.ok) throw new Error('Network response was not ok');
        return await response.json();
    } catch (error) {
        console.error('Error fetching dashboard data:', error);
        return null;
    }
}

function renderDashboard(data) {
    if (!data) return;

    // Update metrics
    document.getElementById('total-employees').textContent = data.total_employees;
    document.getElementById('active-enrollments').textContent = data.active_enrollments;
    document.getElementById('pending-requests').textContent = data.request_stats.total_requests;
    document.getElementById('completion-rate').textContent = `${(data.completion_rate * 100).toFixed(1)}%`;

    // Render charts using Plotly or Chart.js
    renderCharts(data);
}

function renderCharts(data) {
    // Example using Chart.js
    const ctx = document.getElementById('statusChart').getContext('2d');
    new Chart(ctx, {
        type: 'pie',
        data: {
            labels: data.status_distribution.labels,
            datasets: [{
                data: data.status_distribution.values,
                backgroundColor: ['#36A2EB', '#FFCE56']
            }]
        }
    });

}

// Initialize dashboard
async function initDashboard() {
    const data = await fetchDashboardData();
    renderDashboard(data);
    setInterval(async () => {
        const newData = await fetchDashboardData();
        renderDashboard(newData);
    }, 30000); // Refresh every 30 seconds
}

document.addEventListener('DOMContentLoaded', initDashboard);
